
  
  
 
  
 


<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Setup in Distributed Mode &mdash; Jubatus</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootswatch/3.0.0/spacelab/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.5.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.0.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Jubatus" href="index.html" />
    <link rel="next" title="Documentation" href="documentation.html" />
    <link rel="prev" title="Java" href="tutorial/anomaly_java.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">Jubatus</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a href="index.html"
     class="dropdown-toggle"
     data-toggle="dropdown">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
    ><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Setup in Distributed Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="howtocontribute.html">How to Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc.html">Miscellaneous</a></li>
<li class="toctree-l1"><a class="reference internal" href="aboutus.html">About Us</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">Setup in Distributed Mode</a><ul>
<li><a class="reference internal" href="#distributed-mode">Distributed Mode</a><ul>
<li><a class="reference internal" href="#setup-zookeeper">Setup ZooKeeper</a></li>
<li><a class="reference internal" href="#register-configuration-file-to-zookeeper">Register configuration file to ZooKeeper</a></li>
<li><a class="reference internal" href="#jubatus-proxy">Jubatus Proxy</a></li>
<li><a class="reference internal" href="#join-jubatus-servers-to-cluster">Join Jubatus Servers to Cluster</a></li>
<li><a class="reference internal" href="#run-tutorial">Run Tutorial</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cluster-management-in-jubatus">Cluster Management in Jubatus</a><ul>
<li><a class="reference internal" href="#zookeepers-jubatus-proxies">ZooKeepers &amp; Jubatus Proxies</a></li>
<li><a class="reference internal" href="#jubavisor-process-management-agent">Jubavisor: Process Management Agent</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li><a href="tutorial/anomaly_java.html"
         title="Previous Chapter: Java">&laquo; Java</a></li>
  <li><a href="documentation.html"
         title="Next Chapter: Documentation">Documentation &raquo;</a></li>
              
            
            
            
            
              <li>
<div id="sourcelink">
  <a href="_sources/tutorial_distributed.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="setup-in-distributed-mode">
<h1>Setup in Distributed Mode<a class="headerlink" href="#setup-in-distributed-mode" title="Permalink to this headline">¶</a></h1>
<p>In this page, we describe how to setup Jubatus distributed in multiple nodes.</p>
<p>We recommend trying this tutorial after you experience <a class="reference internal" href="tutorial.html"><em>Tutorial</em></a> in standalone mode.</p>
<div class="section" id="distributed-mode">
<h2>Distributed Mode<a class="headerlink" href="#distributed-mode" title="Permalink to this headline">¶</a></h2>
<p>You can run Jubatus in a distributed environment using ZooKeeper and Jubatus proxies.</p>
<p class="blockdiag">
<img src="_images/blockdiag-0b47b09550aab64297de2dae0bb42bb96e9c4314.png" alt="None" width="640" height="280" />
</p>
<div class="section" id="setup-zookeeper">
<h3>Setup ZooKeeper<a class="headerlink" href="#setup-zookeeper" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://zookeeper.apache.org/">ZooKeeper</a> is a centralized service for maintaining configuration information, naming, providing distributed synchronization, and providing group services.
Jubatus in cluster mode uses ZooKeeper to manage Jubatus servers and proxies in cluster environment.</p>
<p>Run ZooKeeper server like this:</p>
<div class="highlight-python"><pre>$ /path/to/zookeeper/bin/zkServer.sh start
JMX enabled by default
Using config: /path/to/zookeeper/bin/../conf/zoo.cfg
Starting zookeeper ...
STARTED</pre>
</div>
<p>Here we assume that ZooKeeper is running on localhost:2181. You can change it in the <tt class="docutils literal"><span class="pre">zoo.cfg</span></tt> file.</p>
</div>
<div class="section" id="register-configuration-file-to-zookeeper">
<h3>Register configuration file to ZooKeeper<a class="headerlink" href="#register-configuration-file-to-zookeeper" title="Permalink to this headline">¶</a></h3>
<p>In distributed environment, register configuration file on the local file system to ZooKeeper using <tt class="docutils literal"><span class="pre">jubaconfig</span></tt>.</p>
<div class="highlight-python"><pre>$ jubaconfig --cmd write --zookeeper=localhost:2181 --file config.json --name tutorial --type classifier</pre>
</div>
</div>
<div class="section" id="jubatus-proxy">
<h3>Jubatus Proxy<a class="headerlink" href="#jubatus-proxy" title="Permalink to this headline">¶</a></h3>
<p>Jubatus proxies proxy RPC requests from clients to servers.
In distributed environment, make RPC requests from clients to proxies, not directly to servers.</p>
<p>Jubatus proxies are provided for each Jubatus servers.
For the classifier, <tt class="docutils literal"><span class="pre">jubaclassifier_keeper</span></tt> is the corresponding proxy.</p>
<div class="highlight-python"><pre>$ jubaclassifier_proxy --zookeeper=localhost:2181 --rpc-port=9198</pre>
</div>
<p>Now <tt class="docutils literal"><span class="pre">jubaclassifier_proxy</span></tt> started listening on TCP port 9198 for RPC requests.</p>
</div>
<div class="section" id="join-jubatus-servers-to-cluster">
<h3>Join Jubatus Servers to Cluster<a class="headerlink" href="#join-jubatus-servers-to-cluster" title="Permalink to this headline">¶</a></h3>
<p>To start Jubatus servers in cluster mode, give <tt class="docutils literal"><span class="pre">--name</span></tt> and <tt class="docutils literal"><span class="pre">--zookeeper</span></tt> option when executing servers.
Server processes started with same name belongs to the same cluster and they collaborate with one another.</p>
<p>If you want to start multiple server processes on the same machine, please note that you must change the port for each processes.</p>
<div class="highlight-python"><pre>$ jubaclassifier --rpc-port=9180 --name=tutorial --zookeeper=localhost:2181 &amp;
$ jubaclassifier --rpc-port=9181 --name=tutorial --zookeeper=localhost:2181 &amp;
$ jubaclassifier --rpc-port=9182 --name=tutorial --zookeeper=localhost:2181 &amp;</pre>
</div>
<p>When Jubatus servers are started in cluster mode, they create a node in ZooKeeper system.
You can verify that three server processes are registered to ZooKeeper system by using ZooKeeper client.</p>
<div class="highlight-python"><pre>$ /path/to/zookeeper/bin/zkCli.sh -server localhost:2181
[zk: localhost:2181(CONNECTED) 0] ls /jubatus/actors/classifier/tutorial/nodes
[XXX.XXX.XXX.XXX_9180, XXX.XXX.XXX.XXX__9181, XXX.XXX.XXX.XXX__9182]</pre>
</div>
</div>
<div class="section" id="run-tutorial">
<h3>Run Tutorial<a class="headerlink" href="#run-tutorial" title="Permalink to this headline">¶</a></h3>
<p>Run the tutorial program again, but this time we use options to specify port to connect to proxies instead of servers.
In cluster mode, you also need to specify the cluster name when making RPC request to proxies.</p>
<div class="highlight-python"><pre>$ python tutorial.py --server_port=9198 --name=tutorial</pre>
</div>
<p>Note that you can use the same client code for both standalone mode and distributed mode.</p>
</div>
</div>
<div class="section" id="cluster-management-in-jubatus">
<h2>Cluster Management in Jubatus<a class="headerlink" href="#cluster-management-in-jubatus" title="Permalink to this headline">¶</a></h2>
<p>Jubatus has a mechanism to centrally manage various processes.
In this tutorial, you will execute some processes on each server as shown in the following table.</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">IP Address</th>
<th class="head">Processes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>192.168.0.1</td>
<td>Terminal</td>
</tr>
<tr class="row-odd"><td>192.168.0.11</td>
<td>jubaclassifier - 1</td>
</tr>
<tr class="row-even"><td>192.168.0.12</td>
<td>jubaclassifier - 2</td>
</tr>
<tr class="row-odd"><td>192.168.0.13</td>
<td>jubaclassifier - 3</td>
</tr>
<tr class="row-even"><td>192.168.0.101</td>
<td>jubaclassifier_proxy/client - 1</td>
</tr>
<tr class="row-odd"><td>192.168.0.102</td>
<td>jubaclassifier_proxy/client - 2</td>
</tr>
<tr class="row-even"><td>192.168.0.103</td>
<td>jubaclassifier_proxy/client - 3</td>
</tr>
<tr class="row-odd"><td>192.168.0.211</td>
<td>ZooKeeper - 1</td>
</tr>
<tr class="row-even"><td>192.168.0.212</td>
<td>ZooKeeper - 2</td>
</tr>
<tr class="row-odd"><td>192.168.0.213</td>
<td>ZooKeeper - 3</td>
</tr>
</tbody>
</table>
<p>For the best practices, see <a class="reference internal" href="admin.html"><em>Cluster Administration Guide</em></a>.</p>
<p class="blockdiag">
<img src="_images/blockdiag-52c7162452245223d479f0cac422c5f4c9975d30.png" alt="None" width="640" height="280" />
</p>
<div class="section" id="zookeepers-jubatus-proxies">
<h3>ZooKeepers &amp; Jubatus Proxies<a class="headerlink" href="#zookeepers-jubatus-proxies" title="Permalink to this headline">¶</a></h3>
<p>Start ZooKeeper servers (make sure you configure an ensemble between them).</p>
<div class="highlight-python"><pre>[192.168.0.211]$ bin/zkServer.sh start
[192.168.0.212]$ bin/zkServer.sh start
[192.168.0.213]$ bin/zkServer.sh start</pre>
</div>
<p>Start <tt class="docutils literal"><span class="pre">jubaclassifier_proxy</span></tt> processes. <tt class="docutils literal"><span class="pre">jubaclassifier_proxy</span></tt> uses TCP port 9199 by default.</p>
<div class="highlight-python"><pre>[192.168.0.101]$ jubaclassifier_proxy --zookeeper 192.168.0.211:2181,192.168.0.212:2181,192.168.0.213:2181
[192.168.0.102]$ jubaclassifier_proxy --zookeeper 192.168.0.211:2181,192.168.0.212:2181,192.168.0.213:2181
[192.168.0.103]$ jubaclassifier_proxy --zookeeper 192.168.0.211:2181,192.168.0.212:2181,192.168.0.213:2181</pre>
</div>
</div>
<div class="section" id="jubavisor-process-management-agent">
<h3>Jubavisor: Process Management Agent<a class="headerlink" href="#jubavisor-process-management-agent" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">jubavisor</span></tt> is an agent process that manages server processes.</p>
<p><tt class="docutils literal"><span class="pre">jubavisor</span></tt> can manage each Jubatus server processes by receiving RPC requests from <tt class="docutils literal"><span class="pre">jubactl</span></tt>, a controller command.
<tt class="docutils literal"><span class="pre">jubavisor</span></tt> uses TCP port 9198 by default.</p>
<div class="highlight-python"><pre>[192.168.0.11]$ jubavisor --zookeeper 192.168.0.211:2181,192.168.0.212:2181,192.168.0.213:2181 --daemon
[192.168.0.22]$ jubavisor --zookeeper 192.168.0.211:2181,192.168.0.212:2181,192.168.0.213:2181 --daemon
[192.168.0.33]$ jubavisor --zookeeper 192.168.0.211:2181,192.168.0.212:2181,192.168.0.213:2181 --daemon</pre>
</div>
<p>Now send commands from <tt class="docutils literal"><span class="pre">jubactl</span></tt> to <tt class="docutils literal"><span class="pre">jubavisor</span></tt>.</p>
<div class="highlight-python"><pre>[192.168.0.1]$ jubactl -c start  --server=jubaclassifier --type=classifier --name=tutorial --zookeeper=192.168.0.211:2181,192.168.0.212:2181,192.168.0.213:2181
[192.168.0.1]$ jubactl -c status --server=jubaclassifier --type=classifier --name=tutorial --zookeeper=192.168.0.211:2181,192.168.0.212:2181,192.168.0.213:2181
active jubaclassifier_proxy members:
 192.168.0.101_9199
 192.168.0.102_9199
 192.168.0.103_9199
active jubavisor members:
 192.168.0.11_9198
 192.168.0.12_9198
 192.168.0.13_9198
active tutorial members:
 192.168.0.11_9199
 192.168.0.12_9199
 192.168.0.13_9199</pre>
</div>
<p>From members list, you can see the server is running.
Now run clients simultaneously, from multiple hosts.</p>
<div class="highlight-python"><pre>[192.168.0.101]$ python tutorial.py --name=tutorial --server_ip 127.0.0.1:9199
[192.168.0.102]$ python tutorial.py --name=tutorial --server_ip 127.0.0.1:9199
[192.168.0.103]$ python tutorial.py --name=tutorial --server_ip 127.0.0.1:9199</pre>
</div>
<p>You can also stop instance of Jubatus server from <tt class="docutils literal"><span class="pre">jubactl</span></tt>.</p>
<div class="highlight-python"><pre>[192.168.0.1]$ jubactl -c stop --server=jubaclassifier --type=classifier --name=tutorial --zookeeper=192.168.0.211:2181,192.168.0.212:2181,192.168.0.213:2181</pre>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2011,2013 PFI &amp; NTT.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2b3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>