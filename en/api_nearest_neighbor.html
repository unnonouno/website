
  
  
 
  
 


<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Nearest Neighbor &mdash; Jubatus</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootswatch/3.0.0/spacelab/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.5.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.0.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Jubatus" href="index.html" />
    <link rel="up" title="Client API" href="api.html" />
    <link rel="next" title="Anomaly" href="api_anomaly.html" />
    <link rel="prev" title="Recommender" href="api_recommender.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">Jubatus</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a href="index.html"
     class="dropdown-toggle"
     data-toggle="dropdown">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
    ><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_distributed.html">Setup in Distributed Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="howtocontribute.html">How to Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc.html">Miscellaneous</a></li>
<li class="toctree-l1"><a class="reference internal" href="aboutus.html">About Us</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">Nearest Neighbor</a><ul>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#data-structures">Data Structures</a></li>
<li><a class="reference internal" href="#methods">Methods</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li><a href="api_recommender.html"
         title="Previous Chapter: Recommender">&laquo; Recommender</a></li>
  <li><a href="api_anomaly.html"
         title="Next Chapter: Anomaly">Anomaly &raquo;</a></li>
              
            
            
            
            
              <li>
<div id="sourcelink">
  <a href="_sources/api_nearest_neighbor.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="nearest-neighbor">
<h1>Nearest Neighbor<a class="headerlink" href="#nearest-neighbor" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>See <a class="reference external" href="https://github.com/jubatus/jubatus/blob/master/jubatus/server/server/nearest_neighbor.idl">IDL definition</a> for detailed specification.</li>
<li>See <a class="reference internal" href="method.html"><em>Methods</em></a> for detailed description of algorithms used in this server.</li>
</ul>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>Configuration is given as a JSON file.
We show each field below:</p>
<dl class="describe">
<dt>
<tt class="descname">method</tt></dt>
<dd><p>Specify algorithm for nearest neighbor.
You can use these algorithms.</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Method</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">&quot;lsh&quot;</span></tt></td>
<td>Use Locality Sensitive Hashing based on cosine similarity.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">&quot;minhash&quot;</span></tt></td>
<td>Use MinHash. <a class="reference internal" href="method.html#ping2010" id="id1">[Ping2010]</a></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">&quot;euclid_lsh&quot;</span></tt></td>
<td>Use LSH based on cosine similarity for nearest neighbor search with Euclidean distance.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="describe">
<dt>
<tt class="descname">parameter</tt></dt>
<dd><p>Specify parameters for the algorithm.
Its format differs for each <tt class="docutils literal"><span class="pre">method</span></tt>.</p>
<dl class="docutils">
<dt>lsh</dt>
<dd><table class="first last docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">hash_num:</th><td class="field-body">Bit length of hash values.
The bigger it is, the more accurate results you can get, but the more memory is required.
(Integer)</td>
</tr>
</tbody>
</table>
</dd>
<dt>minhash</dt>
<dd><table class="first last docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">hash_num:</th><td class="field-body">Bit length of hash values.
The bigger it is, the more accurate results you can get, but the more memory is required.
(Integer)</td>
</tr>
</tbody>
</table>
</dd>
<dt>euclid_lsh</dt>
<dd><table class="first last docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">hash_num:</th><td class="field-body">Bit length of hash values.
The bigger it is, the more accurate results you can get, but the more memory is required.
(Integer)</td>
</tr>
</tbody>
</table>
</dd>
</dl>
</dd></dl>

<dl class="describe">
<dt>
<tt class="descname">converter</tt></dt>
<dd><p>Specify configuration for data conversion.
Its format is described in <a class="reference internal" href="fv_convert.html"><em>Data Conversion</em></a>.</p>
</dd></dl>

<dl class="docutils">
<dt>Example:</dt>
<dd><div class="first last highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;lsh&quot;</span><span class="p">,</span>
  <span class="s2">&quot;parameter&quot;</span> <span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;hash_num&quot;</span> <span class="o">:</span> <span class="mi">64</span>
  <span class="p">},</span>
  <span class="s2">&quot;converter&quot;</span> <span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;string_filter_types&quot;</span><span class="o">:</span> <span class="p">{},</span>
    <span class="s2">&quot;string_filter_rules&quot;</span><span class="o">:</span><span class="p">[],</span>
    <span class="s2">&quot;num_filter_types&quot;</span><span class="o">:</span> <span class="p">{},</span>
    <span class="s2">&quot;num_filter_rules&quot;</span><span class="o">:</span> <span class="p">[],</span>
    <span class="s2">&quot;string_types&quot;</span><span class="o">:</span> <span class="p">{},</span>
    <span class="s2">&quot;string_rules&quot;</span><span class="o">:</span><span class="p">[</span>
      <span class="p">{</span><span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span> <span class="o">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_weight&quot;</span><span class="o">:</span><span class="s2">&quot;bin&quot;</span><span class="p">,</span> <span class="s2">&quot;global_weight&quot;</span> <span class="o">:</span> <span class="s2">&quot;bin&quot;</span><span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;num_types&quot;</span><span class="o">:</span> <span class="p">{},</span>
    <span class="s2">&quot;num_rules&quot;</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span><span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span> <span class="o">:</span> <span class="s2">&quot;num&quot;</span><span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="data-structures">
<h2>Data Structures<a class="headerlink" href="#data-structures" title="Permalink to this headline">¶</a></h2>
<dl class="message">
<dt id="id_with_score">
<em class="property">message </em><tt class="descname">id_with_score</tt><a class="headerlink" href="#id_with_score" title="Permalink to this definition">¶</a></dt>
<dd><p>Represents ID with its score.</p>
<dl class="member">
<dt id="id_with_score::id__s">
0: string <tt class="descname">id</tt><a class="headerlink" href="#id_with_score::id__s" title="Permalink to this definition">¶</a></dt>
<dd><p>Data ID.</p>
</dd></dl>

<dl class="member">
<dt id="id_with_score::score__float">
1: float <tt class="descname">score</tt><a class="headerlink" href="#id_with_score::score__float" title="Permalink to this definition">¶</a></dt>
<dd><p>Score.</p>
</dd></dl>

<div class="highlight-c++"><div class="highlight"><pre><span class="n">message</span> <span class="n">id_with_score</span> <span class="p">{</span>
  <span class="mi">0</span><span class="o">:</span> <span class="n">string</span> <span class="n">id</span>
  <span class="mi">1</span><span class="o">:</span> <span class="kt">float</span> <span class="n">score</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="methods">
<h2>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h2>
<dl class="service">
<dt id="nearest_neighbor">
<em class="property">service </em><tt class="descname">nearest_neighbor</tt><a class="headerlink" href="#nearest_neighbor" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="nearest_neighbor::set_row__s.datum">
bool <tt class="descname">set_row</tt><big>(</big>0: string <em>id</em>, 1: <a class="reference internal" href="common_structs.html#datum" title="datum">datum</a> <em>d</em><big>)</big><a class="headerlink" href="#nearest_neighbor::set_row__s.datum" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>id</strong> &#8211; row ID</li>
<li><strong>row</strong> &#8211; <a class="reference internal" href="common_structs.html#datum" title="datum"><tt class="xref mpidl mpidl-type docutils literal"><span class="pre">datum</span></tt></a> for the row</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">True if this function updates models successfully</p>
</td>
</tr>
</tbody>
</table>
<p>Updates the row whose id is <tt class="docutils literal"><span class="pre">id</span></tt> with given <tt class="docutils literal"><span class="pre">row</span></tt>.
If the row with the same <tt class="docutils literal"><span class="pre">id</span></tt> already exists, the row is overwritten with <tt class="docutils literal"><span class="pre">row</span></tt> (note that this behavior is different from that of recommender).
Otherwise, new row entry will be created.
If the server that manages the row and the server that received this RPC request are same, this operation is reflected instantly.
If not, update operation is reflected after mix.</p>
</dd></dl>

<dl class="method">
<dt id="nearest_neighbor::neighbor_row_from_id__s.U">
list&lt;<a class="reference internal" href="api_anomaly.html#id_with_score" title="id_with_score">id_with_score</a>&gt; <tt class="descname">neighbor_row_from_id</tt><big>(</big>0: string <em>id</em>, 1: uint <em>size</em><big>)</big><a class="headerlink" href="#nearest_neighbor::neighbor_row_from_id__s.U" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>id</strong> &#8211; row ID in the nearest neighbor search table</li>
<li><strong>size</strong> &#8211; number of rows to be returned</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">row IDs that are the nearest to the row <tt class="docutils literal"><span class="pre">id</span></tt> and their distance values</p>
</td>
</tr>
</tbody>
</table>
<p>Returns <tt class="docutils literal"><span class="pre">size</span></tt> rows (at maximum) that have most similar <a class="reference internal" href="common_structs.html#datum" title="datum"><tt class="xref mpidl mpidl-type docutils literal"><span class="pre">datum</span></tt></a> to <tt class="docutils literal"><span class="pre">id</span></tt> and their distance values.</p>
</dd></dl>

<dl class="method">
<dt id="nearest_neighbor::neighbor_row_from_data__datum.U">
list&lt;<a class="reference internal" href="api_anomaly.html#id_with_score" title="id_with_score">id_with_score</a>&gt; <tt class="descname">neighbor_row_from_data</tt><big>(</big>0: <a class="reference internal" href="common_structs.html#datum" title="datum">datum</a> <em>query</em>, 1: uint <em>size</em><big>)</big><a class="headerlink" href="#nearest_neighbor::neighbor_row_from_data__datum.U" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>query</strong> &#8211; <a class="reference internal" href="common_structs.html#datum" title="datum"><tt class="xref mpidl mpidl-type docutils literal"><span class="pre">datum</span></tt></a> for nearest neighbor search</li>
<li><strong>size</strong> &#8211; number of rows to be returned</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">row IDs that are the nearest to <tt class="docutils literal"><span class="pre">query</span></tt> and their distance values</p>
</td>
</tr>
</tbody>
</table>
<p>Returns <tt class="docutils literal"><span class="pre">size</span></tt> rows (at maximum) of which <a class="reference internal" href="common_structs.html#datum" title="datum"><tt class="xref mpidl mpidl-type docutils literal"><span class="pre">datum</span></tt></a> are most similar to <tt class="docutils literal"><span class="pre">query</span></tt> and their distance values.</p>
</dd></dl>

<dl class="method">
<dt id="nearest_neighbor::similar_row_from_id__s.i">
list&lt;<a class="reference internal" href="api_anomaly.html#id_with_score" title="id_with_score">id_with_score</a>&gt; <tt class="descname">similar_row_from_id</tt><big>(</big>0: string <em>id</em>, 1: int <em>ret_num</em><big>)</big><a class="headerlink" href="#nearest_neighbor::similar_row_from_id__s.i" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>id</strong> &#8211; row ID in the nearest neighbor search table</li>
<li><strong>ret_num</strong> &#8211; number of rows to be returned</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">row IDs that are the nearest to the row <tt class="docutils literal"><span class="pre">id</span></tt> and their similarity values</p>
</td>
</tr>
</tbody>
</table>
<p>Returns <tt class="docutils literal"><span class="pre">ret_num</span></tt> rows (at maximum) that have most similar <a class="reference internal" href="common_structs.html#datum" title="datum"><tt class="xref mpidl mpidl-type docutils literal"><span class="pre">datum</span></tt></a> to <tt class="docutils literal"><span class="pre">id</span></tt> and their similarity values.</p>
</dd></dl>

<dl class="method">
<dt id="nearest_neighbor::similar_row_from_data__datum.i">
list&lt;<a class="reference internal" href="api_anomaly.html#id_with_score" title="id_with_score">id_with_score</a>&gt; <tt class="descname">similar_row_from_data</tt><big>(</big>0: <a class="reference internal" href="common_structs.html#datum" title="datum">datum</a> <em>query</em>, 1: int <em>ret_num</em><big>)</big><a class="headerlink" href="#nearest_neighbor::similar_row_from_data__datum.i" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>query</strong> &#8211; <a class="reference internal" href="common_structs.html#datum" title="datum"><tt class="xref mpidl mpidl-type docutils literal"><span class="pre">datum</span></tt></a> for nearest neighbor search</li>
<li><strong>ret_num</strong> &#8211; number of rows to be returned</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">row IDs that are the nearest to <tt class="docutils literal"><span class="pre">query</span></tt> and their similarity values</p>
</td>
</tr>
</tbody>
</table>
<p>Returns <tt class="docutils literal"><span class="pre">ret_num</span></tt> rows (at maximum) of which <a class="reference internal" href="common_structs.html#datum" title="datum"><tt class="xref mpidl mpidl-type docutils literal"><span class="pre">datum</span></tt></a> are most similar to <tt class="docutils literal"><span class="pre">query</span></tt> and their similarity values.</p>
</dd></dl>

</dd></dl>

</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2011,2013 PFI &amp; NTT.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2b3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>