
  
  
 
  
 


<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Python &mdash; Jubatus</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootswatch/3.0.0/spacelab/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.5.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.0.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Jubatus" href="../index.html" />
    <link rel="up" title="Stat" href="stat.html" />
    <link rel="next" title="Anomaly" href="anomaly.html" />
    <link rel="prev" title="Stat" href="stat.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">Jubatus</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a href="../index.html"
     class="dropdown-toggle"
     data-toggle="dropdown">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
    ><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial_distributed.html">Setup in Distributed Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howtocontribute.html">How to Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc.html">Miscellaneous</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aboutus.html">About Us</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">Python</a><ul>
<li><a class="reference internal" href="#source-code">Source_code</a></li>
<li><a class="reference internal" href="#explanation">Explanation</a></li>
<li><a class="reference internal" href="#run-the-sample-program">Run the sample program</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li><a href="stat.html"
         title="Previous Chapter: Stat">&laquo; Stat</a></li>
  <li><a href="anomaly.html"
         title="Next Chapter: Anomaly">Anomaly &raquo;</a></li>
              
            
            
            
            
              <li>
<div id="sourcelink">
  <a href="../_sources/tutorial/stat_python.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="python">
<h1>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h1>
<p>Here we explain the sample program of Stat in Python.</p>
<div class="section" id="source-code">
<h2>Source_code<a class="headerlink" href="#source-code" title="Permalink to this headline">¶</a></h2>
<p>In this sample program, we will explain 1) how to configure the learning-algorithms that used by Jubatus, with the example file &#8216;stat.json&#8217;; 2) how to train the model by &#8216;stat.py&#8217;. Here are the source codes.</p>
<p><strong>stat.json</strong></p>
<div class="highlight-js"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;window_size&quot;</span><span class="o">:</span> <span class="mi">500</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p><strong>stat.py</strong></p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">jubatus.stat.client</span> <span class="kn">import</span> <span class="n">Stat</span>

<span class="n">NAME</span> <span class="o">=</span> <span class="s">&quot;stat_tri&quot;</span><span class="p">;</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>

  <span class="c"># 1. Jubatus Serverへの接続設定</span>
  <span class="c"># 1. Connect to Jubatus Server</span>
  <span class="n">stat</span> <span class="o">=</span> <span class="n">Stat</span><span class="p">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="mi">9199</span><span class="p">,</span> <span class="n">NAME</span><span class="p">)</span>

  <span class="c"># 2. Prepare the training data</span>
  <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;../dat/fruit.csv&#39;</span><span class="p">):</span>
    <span class="n">fruit</span><span class="p">,</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">weight</span> <span class="p">,</span> <span class="n">price</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>

    <span class="c"># 3. Data training (update model)</span>
    <span class="n">stat</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">fruit</span> <span class="o">+</span> <span class="s">&quot;dia&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">diameter</span><span class="p">))</span>
    <span class="n">stat</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">fruit</span> <span class="o">+</span> <span class="s">&quot;wei&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">weight</span><span class="p">))</span>
    <span class="n">stat</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">fruit</span> <span class="o">+</span> <span class="s">&quot;pri&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">price</span><span class="p">))</span>

  <span class="c"># 4. Output result</span>
  <span class="k">for</span> <span class="n">fr</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;orange&quot;</span><span class="p">,</span> <span class="s">&quot;apple&quot;</span><span class="p">,</span><span class="s">&quot;melon&quot;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;dia&quot;</span><span class="p">,</span><span class="s">&quot;wei&quot;</span><span class="p">,</span> <span class="s">&quot;pri&quot;</span><span class="p">]:</span>
      <span class="k">print</span> <span class="s">&quot;sum :&quot;</span><span class="p">,</span> <span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">,</span><span class="n">stat</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">)</span>
      <span class="k">print</span> <span class="s">&quot;sdv :&quot;</span><span class="p">,</span> <span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">,</span><span class="n">stat</span><span class="o">.</span><span class="n">stddev</span><span class="p">(</span><span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">)</span>
      <span class="k">print</span> <span class="s">&quot;max :&quot;</span><span class="p">,</span> <span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">,</span><span class="n">stat</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">)</span>
      <span class="k">print</span> <span class="s">&quot;min :&quot;</span><span class="p">,</span> <span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">,</span><span class="n">stat</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">)</span>
      <span class="k">print</span> <span class="s">&quot;ent :&quot;</span><span class="p">,</span> <span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">,</span><span class="n">stat</span><span class="o">.</span><span class="n">entropy</span><span class="p">(</span><span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">)</span>
      <span class="k">print</span> <span class="s">&quot;mmt :&quot;</span><span class="p">,</span> <span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">,</span><span class="n">stat</span><span class="o">.</span><span class="n">moment</span><span class="p">(</span><span class="n">fr</span> <span class="o">+</span> <span class="n">par</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="explanation">
<h2>Explanation<a class="headerlink" href="#explanation" title="Permalink to this headline">¶</a></h2>
<p><strong>stat.json</strong></p>
<p>The configuration information is given by the JSON unit. Here is the meaning of each JSON filed.</p>
<ul>
<li><dl class="first docutils">
<dt>window_size</dt>
<dd><p class="first last">Specify the amount of value to be retained. (Integer)</p>
</dd>
</dl>
</li>
</ul>
<p><strong>stat.py</strong></p>
<p>Stat.py reads the &#8216;price&#8217;, &#8216;weight&#8217;, &#8216;diameter&#8217; of fruits from the .csv file, and send the info. to Jubatus server. The methods used are listed below.</p>
<ul>
<li><dl class="first docutils">
<dt>bool push(0: string key, 1: double val)</dt>
<dd><p class="first last">Set the attribute info. &#8220;key&#8220;&#8216;s value with &#8220;val&#8221;.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>double sum(0: string key)</dt>
<dd><p class="first last">Return the summary value in the attribute &#8220;key&#8221;.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>double stddev(0: string key)</dt>
<dd><p class="first last">Return the standard deviation of values in the attribute &#8220;key&#8221;.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>double max(0: string key)</dt>
<dd><p class="first last">Return the maximum value of values in the attribute &#8220;key&#8221;.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>double min(0: string key)</dt>
<dd><p class="first last">Return the minimum value of values in the attribute &#8220;key&#8221;.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>double entropy(0: string key)</dt>
<dd><p class="first last">Return the entropy of values in the attribute &#8220;key&#8221;.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>double moment(0: string key, 1: int degree, 2: double center)</dt>
<dd><p class="first last">Return the degree-th moment about &#8216;center&#8217; of values in the attribute &#8220;key&#8221;.</p>
</dd>
</dl>
</li>
</ul>
<ol class="arabic">
<li><dl class="first docutils">
<dt>Connect to Jubatus Server.</dt>
<dd><p class="first">Connect to Jubatus Server (Line 12).</p>
<p class="last">Setting the IP addr, RPC port of Jubatus Server and the unique name for task identification in Zookeeper.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Prepare the learning data</dt>
<dd><p class="first last">Stat client send the &lt;item_name, value&gt; to the server side as training data, by using the push() method.
In this sample program, the training data are generated from a .CSV file which contains the info. of &#8216;fruit type&#8217;, &#8216;price&#8217;, &#8216;weight&#8217;, &#8216;diameter&#8217;.
The source data is read line by line from the .CSV file (Line 14-21).</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Data training (update the model)</dt>
<dd><p class="first last">The training data generated in Step 2 is send to the server site by using the push() method (Line 19-21) for training model there. Items of fruit are renamed as the fruit&#8217;s name extended with the item&#8217;s prefix, eg. item for a fruit&#8217;s diameter is: fruit&#8217;s name + &#8220;dia&#8221;.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Output the result</dt>
<dd><p class="first last">Stat client gets the different statistic results by using its methods.
For each type of fruits(Line 24), the program outputs its statistic results of all the items (Line 25).
Different methods are called (Line 26-31) in the loop above. Their contents are listed in the methods list above.</p>
</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="run-the-sample-program">
<h2>Run the sample program<a class="headerlink" href="#run-the-sample-program" title="Permalink to this headline">¶</a></h2>
<ul>
<li><dl class="first docutils">
<dt>At Jubatus Server</dt>
<dd><p class="first">start &#8220;jubagraph&#8221; process.</p>
<div class="last highlight-python"><pre>$ jubastat --configpath stat.json</pre>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>At Jubatus Client</dt>
<dd><p class="first">Get the required package and Python client ready.</p>
<p>Output:</p>
<div class="last highlight-python"><pre>sum : orangedia 1503.399996995926
sdv : orangedia 10.868084068651045
max : orangedia 54.29999923706055
min : orangedia -2.0999999046325684
ent : orangedia 0.0
mmt : orangedia 28.911538403767807
sum : orangewei 10394.399948120117
sdv : orangewei 54.92258724344468
max : orangewei 321.6000061035156
min : orangewei 39.5
ent : orangewei 0.0
mmt : orangewei 196.1207537381154
sum : orangepri 1636.0
sdv : orangepri 7.936154992801973
max : orangepri 50.0
min : orangepri 6.0
ent : orangepri 0.0
mmt : orangepri 30.867924528301888
sum : appledia 2902.0000019073486
sdv : appledia 15.412238321876663
...
... (omitted)</pre>
</div>
</dd>
</dl>
</li>
</ul>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2011,2013 PFI &amp; NTT.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2b3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>